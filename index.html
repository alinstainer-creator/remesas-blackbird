<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Blackbird Exchange — Terminal</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Roboto+Condensed:wght@300;400;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#04060a;
  --panel:#08121a;
  --accent:#00c0ff;
  --accent2:#0077cc;
  --muted:#9fbfdc;
  --hud: rgba(0,192,255,0.06);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#02030a 70%);color:#e6fbff;font-family:'Roboto Condensed',sans-serif;-webkit-font-smoothing:antialiased}
.page{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
.card{width:100%;max-width:1200px;border-radius:14px;position:relative;overflow:hidden;background:linear-gradient(180deg, rgba(255,255,255,0.007), rgba(255,255,255,0.004));border:1px solid rgba(255,255,255,0.02);box-shadow:0 30px 80px rgba(0,0,0,0.85)}
canvas#bg{position:absolute;inset:0;width:100%;height:100%;z-index:0;opacity:0.12;filter:blur(0.6px)}
header{position:relative;z-index:2;padding:22px 28px;display:flex;gap:18px;align-items:center;border-bottom:1px solid rgba(255,255,255,0.02)}
.logo{width:88px;height:88px;border-radius:50%;border:2px solid var(--accent);box-shadow:0 12px 40px rgba(0,192,255,0.06);object-fit:cover}
.brand h1{font-family:'Orbitron',monospace;color:var(--accent);margin:0;font-size:22px;letter-spacing:1px}
.brand p{margin:6px 0 0;color:var(--muted);font-size:13px}
.main{display:grid;grid-template-columns:1fr 450px;gap:20px;padding:22px;position:relative;z-index:2}
@media(max-width:980px){.main{grid-template-columns:1fr}}
.panel{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.006)); padding:18px; border-radius:12px; border:1px solid rgba(255,255,255,0.02)}
label{display:block;color:var(--muted);font-weight:700;font-size:12px;margin-bottom:8px;text-transform:uppercase}
.input, select{width:100%;padding:12px;border-radius:10px;background:rgba(8,10,14,0.6);border:1px solid rgba(255,255,255,0.03);color:#e9fbff;font-size:15px}
.input:focus, select:focus{outline:none;border-color:var(--accent);box-shadow:0 10px 28px rgba(0,192,255,0.06)}
.controls{display:flex;gap:10px;margin-top:14px}
.btn{padding:10px 14px;border-radius:10px;border:none;font-weight:800;font-family:'Orbitron',monospace;cursor:pointer;font-size:13px}
.btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#031418;box-shadow:0 10px 30px rgba(0,192,255,0.12)}
.btn-ghost{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.03)}
.btn-tele{background:linear-gradient(90deg,#2bd36b,#1ea64b);color:#03110a}
.btn-small{padding:8px 10px;font-size:12px;border-radius:8px}
.hud{margin-top:14px;padding:14px;border-radius:10px;background:linear-gradient(180deg, rgba(0,192,255,0.03), rgba(255,255,255,0.01));border:1px solid rgba(0,192,255,0.06);display:flex;justify-content:space-between;align-items:center}
.hud .left{font-size:14px;color:#eafcff}
.hud .right{font-family:'Orbitron',monospace;color:var(--accent);font-size:20px}
.table-wrap{max-height:520px;overflow:auto}
table{width:100%;border-collapse:collapse;color:#eafcff}
th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.02);text-align:left;font-size:13px}
th{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#031418;font-weight:800;font-size:12px}
.kv{font-size:13px;color:var(--muted)}
.small{font-size:12px;color:var(--muted);margin-top:10px}
</style>
</head>
<body>
<canvas id="bg"></canvas>
<div class="page">
<div class="card" role="main">
<header>
<img class="logo" src="logo blackbird.png" alt="Blackbird logo">
<div class="brand">
<h1>Blackbird Terminal — Cliente</h1>
<p class="kv">Interfaz premium — Cabina SR-71</p>
</div>
</header>

<main class="main">
<section class="panel">
<h2 style="font-family:Orbitron,monospace;color:var(--accent);margin:12px 0">Conversión rápida</h2>
<div>
<label for="selOrigin">Origen</label>
<select id="selOrigin" class="input"><option value="">Cargando países…</option></select>
</div>
<div style="margin-top:12px">
<label for="selDest">Destino</label>
<select id="selDest" class="input"><option value="">Selecciona destino…</option></select>
</div>
<div style="margin-top:12px">
<label for="amount">Monto (moneda local)</label>
<input id="amount" class="input" type="number" inputmode="decimal" min="0" step="0.01" placeholder="Ej. 1000.00">
</div>
<div class="controls">
<button id="btnCalc" class="btn btn-primary">Calcular</button>
<button id="btnCopy" class="btn btn-ghost btn-small">Copiar</button>
<button id="btnTele" class="btn btn-tele btn-small">Pedir por Telegram</button>
</div>
<div class="hud" aria-live="polite">
<div class="left" id="hudLeft">Resultado aparecerá aquí</div>
<div class="right" id="hudRight">--</div>
</div>
</section>

<aside class="panel">
<h3 style="font-family:Orbitron,monospace;color:var(--accent);margin:0 0 12px 0">Tasas detectadas</h3>
<div class="table-wrap">
<table id="ratesTable">
<thead><tr><th>Origen</th><th>Destino</th><th style="text-align:right">Tasa</th></tr></thead>
<tbody><tr><td colspan="3" class="kv" style="padding:18px">Cargando tasas…</td></tr></tbody>
</table>
</div>
</aside>
</main>
<footer style="position:relative;z-index:2;padding:18px;text-align:center;color:var(--muted);border-top:1px solid rgba(255,255,255,0.02)">
© 2025 Blackbird Terminal
</footer>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT9Teo-_5ka3LKx7FXL3x3yV3uf4KhoI61ewnVJyJ90XRnksoObf4CDn-lJvrFKiQ/pub?gid=983978085&single=true&output=csv';
const TELEGRAM = 'https://t.me/+i02VPMg23TNiOWJh';
let rates = {};
let countries = new Set();

/* Helpers */
function parsePrice(raw){if(raw===undefined||raw===null)return NaN;let s=String(raw).trim();if(!s)return NaN;s=s.replace(/\s/g,'').replace(/[^\d\.,\-]/g,'');if(s.indexOf(',')!==-1 && s.indexOf('.')!==-1)s=s.replace(/,/g,'');else if(s.indexOf(',')!==-1)s=s.replace(/,/g,'.');const n=parseFloat(s);return isNaN(n)?NaN:n;}
function tidy(s){return s?String(s).trim().replace(/\s+/g,' '):'';}
function splitPair(raw){if(!raw)return null;let p=String(raw).trim();p=p.replace(/Cotizaci[oó]n Mesa/ig,'').replace(/\(.*?\)/g,'').replace(/[:]/g,'').trim();p=p.replace(/\s+/g,' ');const parts=p.split(/\s*(?:[-–—\/\\]|(?:\sa\s)|(?:\sto\s))\s*/i).map(x=>x.trim()).filter(Boolean);if(parts.length>=2)return [parts[0],parts[1]];const alt=p.split(',').map(x=>x.trim()).filter(Boolean);if(alt.length>=2)return [alt[0],alt[1]];return null;}
function inferDivision(price, origin, dest){if(!isFinite(price)||price<=0)return false;const lowValueHints=['chile','clp','pes','venezuela','ves','bolivar'];const id=(origin+' '+dest).toLowerCase();for(const hint of lowValueHints){if(id.includes(hint)&&price>1)return true;}return price>=10;}
function findNearbyPrice(rows,idx){const cols=[5,6];const offsets=[1,0,-1,2,-2,3,-3];for(const off of offsets){const r=rows[idx+off];if(!r)continue;for(const c of cols){if(r[c]!==undefined && r[c]!==null && String(r[c]).trim()!==''){const p=parsePrice(r[c]);if(!isNaN(p)&&p!==0)return {price:p,rowIdx:idx+off+1,colIndex:c};}}}return null;}
function processRows(rows){rates={};countries=new Set();for(let i=0;i<rows.length;i++){const rawD=rows[i][3]?String(rows[i][3]).trim():'';if(!rawD)continue;if(!/[-–—\/\\]|(\s+a\s)|(\s+to\s)|,/.test(rawD))continue;const parts=splitPair(rawD);if(!parts)continue;const left=tidy(parts[0]);const right=tidy(parts[1]);const found=findNearbyPrice(rows,i);const price=found?found.price:NaN;if(!rates[left])rates[left]={};rates[left][right]={price:isNaN(price)?'No disponible':price};countries.add(left);countries.add(right);}populateUI();renderRatesTable();}
function populateUI(){const sO=document.getElementById('selOrigin');const sD=document.getElementById('selDest');sO.innerHTML='<option value="">Selecciona origen...</option>';sD.innerHTML='<option value="">Selecciona destino...</option>';Array.from(countries).sort((a,b)=>a.localeCompare(b,'es',{sensitivity:'base'})).forEach(c=>{const opt=document.createElement('option');opt.value=c;opt.textContent=c;sO.appendChild(opt);sD.appendChild(opt.cloneNode(true));});}
function renderRatesTable(){const tbody=document.querySelector('#ratesTable tbody');tbody.innerHTML='';const rows=[];for(const f of Object.keys(rates)){for(const t of Object.keys(rates[f]))rows.push({from:f,to:t,price:rates[f][t].price});}if(rows.length===0){tbody.innerHTML='<tr><td colspan="3" class="kv">No disponible</td></tr>';return;}rows.sort((a,b)=>a.from.localeCompare(b.from)||a.to.localeCompare(b.to));rows.forEach(r=>{const tr=document.createElement('tr');const td1=document.createElement('td');td1.textContent=r.from;const td2=document.createElement('td');td2.textContent=r.to;const td3=document.createElement('td');td3.style.textAlign='right';td3.textContent=isNaN(r.price)?r.price:Number(r.price).toLocaleString(undefined,{minimumFractionDigits:4,maximumFractionDigits:4});tr.appendChild(td1);tr.appendChild(td2);tr.appendChild(td3);tbody.appendChild(tr);});}

/* CSV load */
async function loadCSV(){try{const res=await fetch(CSV_URL);if(!res.ok)throw new Error('HTTP '+res.status);const txt=await res.text();Papa.parse(txt,{header:false,skipEmptyLines:true,complete:(results)=>{processRows(results.data);}});}catch(e){console.error(e);alert('No se pudo leer la hoja. Tasas No disponibles.');rates={};populateUI();renderRatesTable();}}

/* UI events */
document.getElementById('btnCalc').addEventListener('click',()=>{
const orig=document.getElementById('selOrigin').value;const dest=document.getElementById('selDest').value;const raw=document.getElementById('amount').value;
const hudL=document.getElementById('hudLeft');const hudR=document.getElementById('hudRight');
if(!orig||!dest||!raw||Number(raw)<=0){hudL.innerHTML='<span style="color:#ff8a8a">Completa origen, destino y monto válido</span>';hudR.innerText='--';return;}
if(orig===dest){hudL.innerHTML='<span style="color:#ff8a8a">Origen y destino deben ser distintos</span>';hudR.innerText='--';return;}
const rate=(rates[orig]&&rates[orig][dest])?rates[orig][dest].price:'No disponible';
hudL.innerHTML=`${Number(raw).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})} → ${dest}:`;hudR.innerText=isNaN(rate)?'No disponible':Number(raw)*rate;
});

loadCSV();
</script>
</body>
</html>

